syntax = "proto3";

package lczero.training;

// Configuration for training algorithm and parameters.
message TrainingConfig {
  ScheduleConfig schedule = 1;
  CheckpointConfig checkpoint = 2;
  OptimizerConfig optimizer = 3;
  LossWeightsConfig losses = 4;
}

message ScheduleConfig {
  int32 steps_per_network = 1;
  int32 chunks_per_network = 2;
}

message OptimizerConfig {
  oneof optimizer_type {
    NadamOptimizerConfig nadam = 1;
  }
  oneof lr_schedule {
    ConstantLRSchedule constant_lr = 2;
  }
  float momentum = 3;
}

message ConstantLRSchedule {
  float lr = 1;
}

message NadamOptimizerConfig {
  float beta_1 = 1;
  float beta_2 = 2;
  float epsilon = 3;
}

message CheckpointConfig {
  string path = 1;
  int32 max_to_keep = 2;
}

message LossWeightsConfig {
  float l2_weight = 1;
  repeated PolicyLossWeightsConfig policy = 2;
  repeated ValueLossWeightsConfig value = 3;
  repeated MovesLeftLossWeightsConfig movesleft = 4;
}

message PolicyLossWeightsConfig {
  string name = 1;
  float weight = 2;
  enum IllegalMoveHandling {
    TRAIN_TO_ZERO = 0;
    MASK = 1;
  }
  IllegalMoveHandling illegal_moves = 3;
}

message ValueLossWeightsConfig {
  string name = 1;
  float weight = 2;
}

message MovesLeftLossWeightsConfig {
  string name = 1;
  float weight = 2;
}